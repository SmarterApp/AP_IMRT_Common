package org.opentestsystem.ap.imrt.common.repository;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.opentestsystem.ap.imrt.common.builder.ImrtItemBuilder;
import org.opentestsystem.ap.imrt.common.builder.StimulusBuilder;
import org.opentestsystem.ap.imrt.common.model.ImrtItem;
import org.opentestsystem.ap.imrt.common.model.Stimulus;
import org.opentestsystem.ap.imrt.common.model.StimulusLink;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.transaction.annotation.Transactional;

import static org.assertj.core.api.Assertions.assertThat;

@RunWith(SpringRunner.class)
@SpringBootTest
@Transactional
public class StimulusRepositoryIntegrationTest {
    @Autowired
    private StimulusRepository stimulusRepository;

    @Autowired
    private ImrtItemRepository imrtItemRepository;

    @Autowired
    private StimulusLinkRepository stimulusLinkRepository;

    @Test
    public void shouldSaveStimulus() {
        ImrtItem item = new ImrtItemBuilder().withId(123).build();
        imrtItemRepository.save(item);
        Stimulus stimulus = new StimulusBuilder().withId(345).build();
        StimulusLink stimulusLink = new StimulusLink(item, stimulus, "me");

        stimulusRepository.save(stimulus);
        stimulusLinkRepository.save(stimulusLink);

        Stimulus persitedStimulus = stimulusRepository.findById(stimulus.getId());

        assertThat(persitedStimulus).isNotNull();

        persitedStimulus.setUpdatedBy("todd");

        stimulusRepository.save(persitedStimulus);
    }
}