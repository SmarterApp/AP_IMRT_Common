package org.opentestsystem.ap.imrt.common.repository;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.opentestsystem.ap.imrt.common.builder.ImrtItemBuilder;
import org.opentestsystem.ap.imrt.common.builder.StimulusBuilder;
import org.opentestsystem.ap.imrt.common.model.ImrtItem;
import org.opentestsystem.ap.imrt.common.model.Stimulus;
import org.opentestsystem.ap.imrt.common.model.StimulusLink;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.transaction.annotation.Transactional;

import java.util.Collections;

import static org.assertj.core.api.Assertions.assertThat;

@RunWith(SpringRunner.class)
@SpringBootTest
@Transactional
public class StimulusRepositoryIntegrationTest {
    @Autowired
    private StimulusRepository stimulusRepository;

    @Autowired
    private ImrtItemRepository imrtItemRepository;

    @Test
    public void shouldSaveStimulus() {
        ImrtItem item = new ImrtItemBuilder().build();
        imrtItemRepository.save(item);
        Stimulus stimulus = new StimulusBuilder().build();
        StimulusLink stimulusLink = new StimulusLink(item, stimulus);

        item.setStimulusLink(stimulusLink);
        stimulus.setRelatedItems(Collections.singletonList(stimulusLink));

        stimulusRepository.save(stimulus);

        Stimulus persitedStimulus = stimulusRepository.findOne(stimulus.getKey());

        assertThat(persitedStimulus).isNotNull();
    }
}